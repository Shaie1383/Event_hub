{% extends "base.html" %}
{% block content %}

<style>
.event-hero {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    margin-top: 20px;
}

.event-img {
    flex: 1;
    min-width: 320px;
}

.event-img img {
    width: 100%;
    border-radius: 14px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
}

.event-info {
    flex: 1;
    min-width: 320px;
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(14px);
    border-radius: 14px;
    padding: 24px;
    border: 1px solid rgba(255,255,255,0.2);
}

.event-info h1 {
    font-size: 2rem;
    font-weight: 800;
    color: #60A5FA;
}

.event-meta {
    color: #bfc7d1;
    margin-top: 6px;
    font-size: 0.95rem;
}

.register-btn {
    margin-top: 20px;
    padding: 12px 26px;
    border: none;
    color: white;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    background: linear-gradient(135deg, #6e3bff, #00d0ff);
    transition: 0.3s ease;
}

.register-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
}

/* MODAL OVERLAY */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(6px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 5000;
}

/* POPUP FORM */
.reg-modal {
    width: 92%;
    max-width: 450px;
    background: rgba(15,23,42,0.92);
    padding: 24px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.16);
    box-shadow: 0 12px 40px rgba(0,0,0,0.45);
    animation: pop 0.25s ease;
}

@keyframes pop {
    from { transform: scale(0.7); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.modal-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #60A5FA;
    margin-bottom: 12px;
}

.close-modal {
    float: right;
    background: none;
    border: none;
    color: #fff;
    font-size: 22px;
    cursor: pointer;
}

.modal-input {
    width: 100%;
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: white;
}

.modal-submit {
    width: 100%;
    margin-top: 18px;
    padding: 12px;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    color: #02101d;
    background: linear-gradient(135deg, #3b82f6, #06b6d4);
    transition: .25s ease;
}
.modal-submit:hover {
    transform: scale(1.04);
}
</style>

<!-- EVENT SECTION -->
<div class="event-hero">

    <div class="event-img" data-aos="fade-right">
        <img src="{{ url_for('static', filename='img/' ~ (event.image or 'placeholder.jpg')) }}">
    </div>

    <div class="event-info" data-aos="fade-left">
        <h1>{{ event.title }}</h1>

        <div class="event-meta">
            üìÖ {{ event.date }}  
            <br>
            üìç {{ event.location }}
            <br>
            üë• Team Size: {{ event.team_size }}
            <br>
            üíµ Fee: {{ event.fee }}
        </div>

        <p style="margin-top:18px; color:#d0d7e5;">
            {{ event.description_long }}
        </p>
        
        {# Ripples sub-events: technical & non-technical #}
        {% if technical_events %}
        <div style="margin-top:20px;">
            <h3 style="color:#93C5FD; margin-bottom:10px;">Technical Events</h3>
            <div style="display:flex;flex-wrap:wrap;gap:12px;">
                {% for sub in technical_events %}
                <div style="background:rgba(255,255,255,0.04);padding:12px;border-radius:10px;min-width:220px;flex:1;max-width:320px;border:1px solid rgba(255,255,255,0.06);">
                    <strong style="color:#E0F2FE;">{{ sub.title }}</strong>
                    <div style="color:#cbd5e1;font-size:0.95rem;margin-top:6px;">{{ sub.desc }}</div>
                    <div style="margin-top:8px;color:#cbd5e1;font-size:0.9rem;">Fee: {{ sub.fee }} &nbsp; ‚Ä¢ &nbsp; Team: {{ sub.team_size }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if non_technical_events %}
        <div style="margin-top:18px;">
            <h3 style="color:#FECACA; margin-bottom:10px;">Non-Technical Events</h3>
            <div style="display:flex;flex-wrap:wrap;gap:12px;">
                {% for sub in non_technical_events %}
                <div style="background:rgba(255,255,255,0.04);padding:12px;border-radius:10px;min-width:220px;flex:1;max-width:320px;border:1px solid rgba(255,255,255,0.06);">
                    <strong style="color:#FEF3C7;">{{ sub.title }}</strong>
                    <div style="color:#cbd5e1;font-size:0.95rem;margin-top:6px;">{{ sub.desc }}</div>
                    <div style="margin-top:8px;color:#cbd5e1;font-size:0.9rem;">Fee: {{ sub.fee }} &nbsp; ‚Ä¢ &nbsp; Team: {{ sub.team_size }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
<button class="register-btn" 
        data-id="{{ event.id }}" 
        data-title="{{ event.title|escape }}" 
        onclick="openRegister(this.dataset.id, this.dataset.title)">
    Register
</button>
    </div>

</div>


<!-- CENTER POPUP MODAL -->
<div id="registerOverlay" class="modal-overlay">

    <div class="reg-modal">

        <button class="close-modal" onclick="closeRegister()">&times;</button>

        <div class="modal-title" id="modalEventName">Register</div>

        <form id="popupRegisterForm">

            <input type="hidden" name="event_id" id="modalEventID">

            <input class="modal-input" name="name" placeholder="Your Name" required>
            <input class="modal-input" name="regno" placeholder="Registration No" required>
            <input class="modal-input" type="email" name="email" placeholder="Email" required>
            <input class="modal-input" name="mobile" placeholder="Mobile">

            <select class="modal-input" name="year" required>
                <option value="">Select Year</option>
                <option>1st</option>
                <option>2nd</option>
                <option>3rd</option>
                <option>4th</option>
            </select>

            <button class="modal-submit">Submit Registration</button>

        </form>

    </div>

</div>

<script>
function openRegister(id, title) {
    document.getElementById("modalEventID").value = id;
    document.getElementById("modalEventName").innerText = "Register for " + title;
    document.getElementById("registerOverlay").style.display = "flex";
}

function closeRegister() {
    document.getElementById("registerOverlay").style.display = "none";
}

// Submit via AJAX
document.getElementById("popupRegisterForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const formData = new FormData(this);

    const res = await fetch("/register-event", {
        method: "POST",
        body: formData
    });

    const json = await res.json();

    if(res.ok) {
        alert(json.message || "Registered!");
        closeRegister();
        this.reset();
    } else {
        alert(json.error || "Registration failed");
    }
});
</script>

{% endblock %}
